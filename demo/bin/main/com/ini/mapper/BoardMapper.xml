<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ini.board.mapper.BoardMapper">

 <resultMap id="BoardResultMap" type="com.ini.board.vo.BoardDTO">
    <id property="board_id" column="board_id"/>
    <result property="board_title" column="board_title"/>
    <result property="board_content" column="board_content"/>
    <result property="user_id" column="user_id"/>
    <result property="board_views" column="board_views"/>
    <result property="board_write_date" column="board_write_date"/>
    <result property="board_update_date" column="board_update_date"/>
    <result property="board_category" column="board_category"/>
    <result property="board_tag" column="board_tag"/>
    <!-- likes와 comments는 0으로 고정하니 매핑 안해도 무방 -->
</resultMap>


  <!-- ✅ 게시글 목록 조회 -->
  <select id="selectBoardList" resultMap="BoardResultMap">
    SELECT 
      board_id,
      board_title,
      board_content,
      user_id,
      board_views,
      board_write_date,
      board_update_date,
      board_category,
      board_tag,
      0 AS likes,
      0 AS comments
    FROM ini_board
    <trim prefix="WHERE" prefixOverrides="AND">
      <if test="keyword != null and keyword != ''">
        AND (board_title LIKE '%' || #{keyword} || '%'
             OR board_content LIKE '%' || #{keyword} || '%')
      </if>
      <if test="category != null and category != ''">
        AND board_category = #{category}
      </if>
    </trim>
    ORDER BY board_write_date DESC
    OFFSET #{offset} ROWS FETCH NEXT #{limit} ROWS ONLY
  </select>

  <!-- ✅ 게시글 총 개수 조회 -->
  <select id="countBoards" resultType="int">
    SELECT COUNT(*) FROM ini_board
    <trim prefix="WHERE" prefixOverrides="AND">
      <if test="keyword != null and keyword != ''">
        AND (board_title LIKE '%' || #{keyword} || '%'
             OR board_content LIKE '%' || #{keyword} || '%')
      </if>
      <if test="category != null and category != ''">
        AND board_category = #{category}
      </if>
    </trim>
  </select>

  <!-- ✅ 게시글 상세 조회 (추가 예시) -->
  <select id="selectBoardById" resultMap="BoardResultMap">
    SELECT 
      board_id,
      board_title,
      board_content,
      user_id,
      board_views,
      board_write_date,
      board_update_date,
      board_category,
      board_tag,
      0 AS likes,
      0 AS comments
    FROM ini_board
    WHERE board_id = #{boardId}
  </select>

</mapper>
