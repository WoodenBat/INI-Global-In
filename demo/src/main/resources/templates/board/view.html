<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
	    <title th:text="${board.board_title}">ê²Œì‹œê¸€ ë³´ê¸°</title>
	</head>
	<body>
	
	<h1 th:text="${board.board_title}">ì œëª©</h1>
	
	<div>
	    <p><strong>ë§ë¨¸ë¦¬:</strong> <span th:text="${board.tag_name}"></span></p>
	    <p><strong>ì¹´í…Œê³ ë¦¬:</strong> <span th:text="${board.category_name}"></span></p>
	    <p><strong>ì‘ì„±ì:</strong> <span th:text="${board.user_nickname}"></span></p>
	    <p><strong>ì‘ì„±ì¼:</strong> <span th:text="${#dates.format(board.board_write_date, 'yyyy-MM-dd HH:mm')}"></span></p>
	    <p><strong>ì¡°íšŒìˆ˜:</strong> <span th:text="${board.board_views}"></span></p>
	</div>
	
	<hr>
	
	<!-- ê²Œì‹œê¸€ ë³¸ë¬¸ -->
	<div th:utext="${board.board_content}">ë³¸ë¬¸</div>
	
	<!-- ì²¨ë¶€ ì´ë¯¸ì§€ í‘œì‹œ -->
	<div>
	    <h3>ì²¨ë¶€ ì´ë¯¸ì§€</h3>
	    <th:block th:if="${imageList != null and !#lists.isEmpty(imageList)}">
	        <div th:each="image : ${imageList}">
	            <th:block th:if="${image.imagePath != null and !#strings.isEmpty(image.imagePath)}">
	                <img th:src="@{'/uploads/' + ${image.imagePath}}"
	                     th:alt="${image.originalName}"
	                     style="max-width:100%; height:auto;" />
	            </th:block>
	        </div>
	    </th:block>
	</div>
	
	<hr>
	
	<!-- í•˜ë‹¨ ë²„íŠ¼ ì˜ì—­ -->
	<div style="margin-top: 20px;">
	    <form th:action="@{/board/list}" method="get" style="display:inline;">
	        <button type="submit" style="margin-right: 10px;">ëª©ë¡</button>
	    </form>
	    
	    <form th:action="@{'/board/edit/' + ${board.board_id}}" method="get" style="display:inline;">
	        <button type="submit" style="margin-right: 10px;">ìˆ˜ì •</button>
	    </form>
	
	    <form th:action="@{'/board/delete/' + ${board.board_id}}" method="post" style="display:inline;">
	        <button type="submit" onclick="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ì‚­ì œ</button>
	    </form>
	</div>

	
	<!-- ì¢‹ì•„ìš” ë²„íŠ¼ -->
	<div style="margin-top: 20px;">
	    <button id="likeBtn">
	        <span id="likeIcon" th:text="${liked} ? 'â¤ï¸' : 'ğŸ¤'"></span>
	        <span id="likeCount" th:text="${likeCount}">0</span>
	    </button>
	</div>
	
	<!-- ì¢‹ì•„ìš” ê¸°ëŠ¥ ìŠ¤í¬ë¦½íŠ¸ -->
	<script>
	let isProcessing = false;
	document.getElementById("likeBtn").addEventListener("click", function () {
	    if (isProcessing) return;
	    isProcessing = true;
	    const boardId = [[${board.board_id}]];
	    fetch(`/board/like/${boardId}`, {
	        method: 'POST'
	    })
	    .then(res => res.json())
	    .then(data => {
	        document.getElementById("likeIcon").textContent = data.liked ? 'â¤ï¸' : 'ğŸ¤';
	        document.getElementById("likeCount").textContent = data.likeCount;
	    })
	    .finally(() => isProcessing = false);
	});
	</script>
	
	<button id="reportBtn">ì‹ ê³ í•˜ê¸°</button>

<div id="reportModal" style="display:none;">
    <form id="reportForm">
        <label>ì‹ ê³  ì¢…ë¥˜:</label>
        <select name="report_category" required>
            <option value="">ì„ íƒ</option>
            <option value="ìš•ì„¤">ìš•ì„¤</option>
            <option value="ìŠ¤íŒ¸">ìŠ¤íŒ¸</option>
            <option value="ê¸°íƒ€">ê¸°íƒ€</option>
        </select>
        <br>
        <label>ì‹ ê³  ë‚´ìš©:</label><br>
        <textarea name="report_content" required></textarea><br>
        <button type="submit">ì‹ ê³  ì œì¶œ</button>
        <button type="button" id="closeModal">ì·¨ì†Œ</button>
    </form>
</div>

<script>
    document.getElementById('reportBtn').addEventListener('click', () => {
        document.getElementById('reportModal').style.display = 'block';
    });

    document.getElementById('closeModal').addEventListener('click', () => {
        document.getElementById('reportModal').style.display = 'none';
    });

    document.getElementById('reportForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const form = e.target;
        const data = {
            board_id: [[${board.board_id}]],
            report_category: form.report_category.value,
            report_content: form.report_content.value
        };

        try {
            const response = await fetch('/board/report', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            });

            if (response.ok) {
                alert('ì‹ ê³ ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.');
                document.getElementById('reportModal').style.display = 'none';
            } else {
                const errorText = await response.text();
                alert(errorText);
            }
        } catch (err) {
            alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    });
</script>
	</body>
	</html>
