<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<link rel="stylesheet" th:href="@{/css/boardReply.css}" />
</head>
<script type="text/javascript">

    function getBoardReply(board_id) {
        $.ajax({
            type : "GET",
            url : "/board/reply/boardReply",
            data : {
                board_id : board_id
            },
            success : function (response) {
                console.log("성공:", response);
                console.log(response);
                $(".board_reply_wrapper").empty();

                response.forEach(function (br) {
                    // 댓글 상태별로 조건 분기
                    let html = '';
					console.log(br);
                    if (br.reply_status === 'reply') {
                        html += `
                            <div class="board_reply_container">
                                <div class="board_reply_info">
                                    <img class="board_reply_profileImg" alt="프로필 사진" src="/images/cat.png">
                                    <span class="board_reply_userNickName">${br.user_nickname}</span>
                                    <span class="board_reply_write_date">${br.reply_write_date}</span>
                                    <div class="board_reply_report_btn">
                                        <img alt="신고버튼" src="/img/icon/reply_report_icon.png" />
                                    </div>
                                </div>
                                <div class="board_reply_content_container">
                                    <span class="board_reply_content">${br.reply_content}</span>
                                </div>
                                <div class="board_reply_button_container">
                                    <button type="button" class="board_reply_button">대댓글 작성</button>
                                    <button type="button" class="board_reply_button">댓글 수정</button>
                                </div>
                            </div>
                        `;
                    } else {
                        html += `
                            <div class="board_reply_reReply_container">
                                <div class="board_reply_reReply_box">
                                	<div class="board_reply_reReply_icon_container">
                                		<img alt="대댓글 아이콘" src="/img/icon/reReply_icon.png" />
                                	</div>
                                	<div class="board_reply_container_inner">
		                                <div class="board_reply_reReply_info">
		                                    <img class="board_reply_profileImg" alt="프로필 사진" src="/images/cat.png">
		                                    <span class="board_reply_userNickName">${br.user_nickname}</span>
		                                    <span class="board_reply_write_date">${br.reply_write_date}</span>
		                                    <div class="board_reply_report_btn">
		                                        <img alt="신고버튼" src="/img/icon/reply_report_icon.png" />
		                                    </div>
		                                </div>
		                                <div class="board_reply_content_container">
		                                    <span class="board_reply_content">${br.reply_content}</span>
		                                </div>
		                                <div class="board_reply_button_container">
		                                    <button type="button" class="board_reply_button">대댓글 작성</button>
		                                    <button type="button" class="board_reply_button">댓글 수정</button>
		                                </div>
	                                </div>
                                </div>
                            </div>
                        `;
                    }
                    $(".board_reply_wrapper").append(html);
                });
            },
            error : function (xhr, status, error) {
                console.error("에러:", error);
            }
        });
    }
    
    $("#reply_insert_btn").click(function() {
        $.ajax({
            type : "POST",
            url : "/board/reply/boardReply",
            data : {
                reply_content : $("#reply_insert_form").val(),
                reply_writer : "test",
                board_id : 999,
            },
            success : function (response) {
                console.log("성공:", response);
                console.log(response);
            },
            error : function (xhr, status, error) {
                console.error("에러:", error);
            }
        })
    })
    
    $(document).ready(function () {
    })
</script>
<body>

	<button onclick="getBoardReply(999);">댓글 가져오기</button>

	<div class="board_reply_wrapper"></div>

	<div class="board_reply_insert_container">
		<textarea id="reply_insert_form" class="board_reply_insert_form" placeholder="댓글 작성하기"></textarea>
		<button id="reply_insert_btn" class="board_reply_insert_btn">작성</button>
	</div>
</body>
</html>